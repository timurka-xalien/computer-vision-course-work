Данная программа выполняет детекцию и вычисление скорости автомобилей на видео.  

Реализация очень сырая и протестирована только на одном видео, снятом на камеру с небольшим углом обзора, видео снято под таким углом, что перспективное искажение мало и им можно пренебречь. Таким образом, этот кейс является достаточно простым и, можно сказать, синтетическим. Я планировал сделать поддержку и видео с перспективным искажением, но это оказалось достаточно сложным для меня, чтобы разобраться в ограниченное время.
Для детекции используется модель YOLO 8n, для трекинга BotSort трекер, встроенный в YOLO.  
Для маппинга координат видео в мировые координаты использовалась ручная разметка точек на видео и сопоставление их с грубо прикинутыми мировыми координатами. В качестве ориентира брался автомобиль Skoda Octavia A5 в центре видео, поскольку его размеры известны. Для указания координат используется конфиг файл.  
Для расчета скорости используется алгоритм, состоящий из нескольких основных шагов  

 * чтобы отбросить дрожание bbox используется сравнение текущего bbox для объекта с bbox, предыдущих кадров. В случае, если изменяется только 1 точка, то этот bbox отбрасывается, также отбрасываются bbox, у которых разница с bbox 3 кадра назад меньше 1 пикселя по любой из координат
 * первые 1/4 fps кадров после детекции объекта скорость не отображается, а только собираются исторические данные для расчета в дальнейшем
 * чтобы сделать изменение скорости более плавным, используется взвешенное скользящее среднее с учетом расстояния от медианы с окном в 2 секунды (48 кадров в демонстрационном видео)
 * чтобы как можно раньше отреагировать на резкое изменение скорости, например, стоящее много кадров авто начинает ехать или наоборот, едущее авто резко тормозит, используется дополнительное окно размером 1/4 fps (6 кадров в демонстрационном видео), которое берется из последних кадров и по нему отдельно считается взвешенное среднее с учетом расстояния от медианы. Если эти два расчитанных средних отличаются друг от друга более чем в 2 раза, то принимается решение, что мы имеем дело с резкой сменой характера движения. В таком случае для расчета скорости используется только дополнительное окно, а более старые исторические данные игнорируются

Программу можно просто запустить, путь к демонстрационному видео захардкоджен, так что оно сразу загрузится и начнется покадровое отображение видео с отрисовкой объектов и их скоростей.
